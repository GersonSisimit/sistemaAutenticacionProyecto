@{
    ViewData["Title"] = "Habilitar MFA (TOTP)";
}

<h3 class="mt-3">@ViewData["Title"]</h3>

@if (TempData["Ok"] != null)
{
    <div class="alert alert-success">@TempData["Ok"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (TempData["Ok"] == null)  
{
    @* Si hubo error fuerte que no sea "ya configurado", ViewBag.Error podría estar set *@
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">@ViewBag.Error</div>
    }
    else
    {
        <p>Escanea este código en Google Authenticator, Microsoft Authenticator o Authy.</p>
        <div class="text-center mb-3">
            <img src="@ViewBag.QrBase64" alt="QR TOTP" style="max-width: 280px;" />
        </div>
        <p><strong>Clave manual:</strong> <code>@ViewBag.ManualKey</code></p>

        <hr />
        <form asp-action="VerifyMfa" method="post" class="row g-2">
            <div class="col-md-6">
                <input name="otpCode" class="form-control" placeholder="Código de 6 dígitos"
                       inputmode="numeric" pattern="\d{6}" maxlength="6" required />
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-success w-100">Verificar</button>
            </div>
            <div class="col-md-3">
                <a asp-controller="Vehicles" asp-action="Administrar" class="btn btn-secondary w-100">Volver</a>
            </div>
        </form>
    }
}
